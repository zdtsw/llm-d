apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - ../../base

patches:
  # Apply strategic merge patch for prefill configuration
  - path: deployment-patch.yaml

  # Rename deployment to "prefill"
  - target:
      kind: Deployment
      name: llm-d-model-server
    patch: |-
      - op: replace
        path: /metadata/name
        value: prefill

  # Set ports for prefill: 8000 (vLLM API) and 5600 (nixl side channel)
  - target:
      kind: Deployment
      name: prefill
    patch: |-
      - op: replace
        path: /spec/template/spec/containers/0/ports
        value:
          - containerPort: 8000
            name: http
            protocol: TCP
          - containerPort: 5600
            name: nixl
            protocol: TCP
