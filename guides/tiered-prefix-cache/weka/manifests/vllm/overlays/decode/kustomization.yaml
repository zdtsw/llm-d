apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - ../../base

patches:
  # Apply strategic merge patch for decode configuration
  - path: deployment-patch.yaml

  # Rename deployment to "decode"
  - target:
      kind: Deployment
      name: llm-d-model-server
    patch: |-
      - op: replace
        path: /metadata/name
        value: decode

  # Set ports for decode: 8200 (vLLM API) and 5600 (nixl side channel)
  - target:
      kind: Deployment
      name: decode
    patch: |-
      - op: replace
        path: /spec/template/spec/containers/0/ports
        value:
          - containerPort: 8200
            name: metrics
            protocol: TCP
          - containerPort: 5600
            name: nixl
            protocol: TCP
